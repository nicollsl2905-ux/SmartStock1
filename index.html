<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartStock MVP</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-gradient-to-r from-blue-600 to-white-700 text-white p-5 flex justify-between items-center shadow-lg">
    <h1 class="text-2xl font-extrabold tracking-wide flex items-center gap-2">ğŸ“¦ SmartStock</h1>
    <div class="flex items-center gap-4">
      <button id="btnEscanear" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-700 hover:to-blue-700 text-white px-4 py-2 rounded-lg shadow-md transition-transform transform hover:scale-105 font-semibold">Escanear</button>
      <div id="susStatus" class="text-sm bg-white text-blue-700 px-3 py-1 rounded-lg shadow">No suscrito</div>
    </div>
  </header>

  <!-- Imagen de portada -->
  <section class="relative">
    <img src="https://www.hostelvending.com/uploads/noticias/img/vending_market.webp" alt="SmartStock Banner" class="w-full h-64 object-cover" />
    <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center">
      <h2 class="text-white text-3xl md:text-4xl font-bold">Bienvenido a SmartStock</h2>
    </div>
  </section>

  <main class="flex-1 p-6 space-y-6">
    <!-- Dashboard -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="bg-white rounded-2xl shadow-lg p-6 text-center hover:shadow-2xl transition">
        <h2 class="font-bold text-gray-700">Total Productos</h2>
        <p id="totalProductos" class="text-4xl font-extrabold text-blue-600 mt-2">0</p>
      </div>
      <div class="bg-white rounded-2xl shadow-lg p-6 text-center hover:shadow-2xl transition">
        <h2 class="font-bold text-gray-700">Bajo Stock</h2>
        <p id="bajoStock" class="text-4xl font-extrabold text-yellow-500 mt-2">0</p>
      </div>
    </section>

    <!-- Formulario -->
    <section class="bg-white rounded-xl shadow p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold">Agregar Producto</h2>
        <div class="text-sm text-gray-600">Puedes escanear con la cÃ¡mara â†’ botÃ³n en el header</div>
      </div>

      <form id="formProducto" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input type="text" placeholder="Nombre" id="nombre" class="border rounded p-2" required />
        <div class="flex gap-2">
          <input type="text" placeholder="CÃ³digo" id="codigo" class="border rounded p-2 flex-1" required />
          <button type="button" id="btnPasteScan" class="bg-gray-600 text-white px-4 py-2 rounded 
               shadow-md hover:shadow-lg 
               transform hover:-translate-y-1 
               transition duration-200">Pegar/Scan</button>
        </div>
        <input type="number" placeholder="Cantidad" id="cantidad" class="border rounded p-2" required />
        <div class="col-span-2 flex gap-4">
          <button type="submit" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-700 hover:to-blue-700 text-white px-4 py-2 rounded-lg shadow-md transition-transform transform hover:scale-105 font-semibold">Agregar</button>
        </div>
      </form>
    </section>

    <!-- Inventario -->
    <section class="bg-white rounded-xl shadow p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold">Inventario</h2>
        <input type="text" id="buscar" placeholder="Buscar..." class="border rounded p-2" />
      </div>
      <table class="w-full border-collapse rounded-xl overflow-hidden shadow-lg">
        <thead>
          <tr class="bg-gradient-to-r from-blue-600 to-blue-700 text-white">
            <th class="p-3 text-left">CÃ³digo</th>
            <th class="p-3 text-left">Nombre</th>
            <th class="p-3 text-left">Cantidad</th>
            <th class="p-3 text-left">Estado</th>
            <th class="p-3 text-left">AcciÃ³n</th>
          </tr>
        </thead>
        <tbody id="tablaInventario" class="divide-y divide-gray-200 bg-white"></tbody>
      </table>
    </section>

    <!-- Planes -->
    <section id="planes" class="bg-white rounded-xl shadow p-6">
      <h2 class="text-lg font-semibold mb-6 text-center">Planes Premium</h2>
      <div class="grid md:grid-cols-3 gap-6 text-center">
        <div class="bg-gray-50 p-4 rounded-xl shadow">
          <h3 class="font-bold text-lg mb-2">BÃ¡sico</h3>
          <p class="text-2xl font-bold mb-2">$9.99/mes</p>
          <ul class="text-sm space-y-1 mb-4">
            <li>âœ” Hasta 150 productos</li>
            <li>âœ” Alertas bÃ¡sicas</li>
            <li>âœ” Soporte limitado</li>
          </ul>
          <button class="bg-blue-600 text-white px-4 py-2 rounded 
               shadow-md hover:shadow-lg 
               transform hover:-translate-y-1 
               transition duration-200" data-plan="Basico">Suscribirse</button>
        </div>

        <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-2xl transition transform hover:scale-105">
          <h3 class="font-extrabold text-lg mb-2 text-blue-700">Pro</h3>
          <p class="text-3xl font-extrabold mb-4 text-blue-600">$19.99/mes</p>
          <ul class="text-sm space-y-1 mb-4">
            <li>âœ” Hasta 200 productos</li>
            <li>âœ” Reportes avanzados</li>
            <li>âœ” Soporte prioritario</li>
          </ul>
          <button class="btnSuscribirse bg-blue-600 text-white px-4 py-2 rounded 
               shadow-md hover:shadow-lg 
               transform hover:-translate-y-1 
               transition duration-200" data-plan="Pro">Suscribirse</button>
        </div>

        <div class="bg-gray-50 p-4 rounded-xl shadow">
          <h3 class="font-bold text-lg mb-2">Empresarial</h3>
          <p class="text-2xl font-bold mb-2">$49.99/mes</p>
          <ul class="text-sm space-y-1 mb-4">
            <li>âœ” Productos ilimitados</li>
            <li>âœ” Reportes completos</li>
            <li>âœ” Soporte dedicado</li>
          </ul>
          <button class="btnSuscribirse bg-blue-600 text-white px-4 py-2 rounded 
               shadow-md hover:shadow-lg 
               transform hover:-translate-y-1 
               transition duration-200" data-plan="Empresarial">Suscribirse</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal Pago (simulado) -->
  <div id="modalPago" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-6 w-11/12 md:w-1/2">
      <h3 class="text-xl font-bold mb-4">Suscribirse - <span id="planSelected">Plan</span></h3>
      <form id="formPago" class="grid gap-3">
        <input type="text" id="cardName" placeholder="Nombre en la tarjeta" class="border rounded p-2" required />
        <input type="text" id="cardNumber" placeholder="NÃºmero de tarjeta (ej: 4242 4242 4242 4242)" class="border rounded p-2" required />
        <div class="flex gap-2">
          <input type="text" id="cardMonth" placeholder="MM" class="border rounded p-2 w-1/3" required />
          <input type="text" id="cardYear" placeholder="AA" class="border rounded p-2 w-1/3" required />
          <input type="text" id="cardCVC" placeholder="CVC" class="border rounded p-2 w-1/3" required />
        </div>
        <div class="flex justify-end gap-2 mt-2">
          <button type="button" id="cancelPago" class="bg-red-600 text-white px-4 py-2 rounded 
               shadow-md hover:shadow-lg 
               transform hover:-translate-y-1 
               transition duration-200">Cancelar</button>
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded 
               shadow-md hover:shadow-lg 
               transform hover:-translate-y-1 
               transition duration-200">Pagar</button>
        </div>
        <p class="text-xs text-gray-500 mt-2">* Pago simulado. Para pagos reales, integra Stripe/PayPal en backend.</p>
      </form>
    </div>
  </div>

  <!-- Modal CÃ¡mara -->
  <div id="modalCamara" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-4 w-11/12 md:w-3/4">
      <div class="flex justify-between items-center mb-2">
        <h3 class="font-bold">EscÃ¡ner â€“ CÃ¡mara</h3>
        <button id="closeCam" class="text-sm px-2 py-1 rounded border">Cerrar</button>
      </div>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <video id="video" autoplay playsinline class="w-full h-64 bg-black rounded"></video>
          <div class="flex gap-2 mt-2">
            <button id="captureBtn" class="bg-blue-600 text-white px-3 py-1 rounded 
               shadow-md hover:shadow-lg 
               transform hover:-translate-y-1 
               transition duration-200">Capturar</button>
            <button id="detectBtn" class="bg-green-600 text-white px-3 py-1 rounded 
               shadow-md hover:shadow-lg 
               transform hover:-translate-y-1 
               transition duration-200">Detectar</button>
            <button id="stopCam" class="bg-red-600 text-white px-3 py-1 rounded 
               shadow-md hover:shadow-lg 
               transform hover:-translate-y-1 
               transition duration-200">Detener</button>
          </div>
        </div>
        <div>
          <canvas id="canvas" class="w-full h-64 bg-gray-100 rounded"></canvas>
          <div class="mt-2 text-sm text-gray-600">Resultado detecciÃ³n: <span id="scanResult">â€”</span></div>
          <div class="mt-2">
            <label class="block text-sm">Si no detecta, pegue o escriba el cÃ³digo:</label>
            <input id="manualCode" class="border rounded p-2 w-full mt-1" placeholder="CÃ³digo detectado o manual" />
            <button id="applyCode" class="bg-blue-600 text-white px-4 py-2 rounded 
               shadow-md hover:shadow-lg 
               transform hover:-translate-y-1 
               transition duration-200">Usar en campo CÃ³digo</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Inventario bÃ¡sico ---
    const form = document.getElementById("formProducto");
    const tabla = document.getElementById("tablaInventario");
    const totalProductos = document.getElementById("totalProductos");
    const bajoStock = document.getElementById("bajoStock");
    const buscar = document.getElementById("buscar");

    let inventario = JSON.parse(localStorage.getItem('inventario')) || [];

    function saveInventory() {
      localStorage.setItem('inventario', JSON.stringify(inventario));
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const nombre = document.getElementById("nombre").value.trim();
      const codigo = document.getElementById("codigo").value.trim();
      const cantidad = parseInt(document.getElementById("cantidad").value);

      if (!nombre || !codigo || Number.isNaN(cantidad)) return alert('Completa todos los campos');

      // Si existe cÃ³digo, actualizar cantidad sumando
      const existe = inventario.find(p => p.codigo === codigo);
      if (existe) {
        existe.cantidad += cantidad;
      } else {
        inventario.push({ codigo, nombre, cantidad });
      }
      saveInventory();
      form.reset();
      renderTabla();
    });

    buscar.addEventListener("input", renderTabla);

    function eliminarProducto(codigo) {
      inventario = inventario.filter(p => p.codigo !== codigo);
      saveInventory();
      renderTabla();
    }

    function renderTabla() {
      tabla.innerHTML = "";
      let bajos = 0;
      const filtro = buscar.value.toLowerCase();

      inventario
        .filter(p => p.nombre.toLowerCase().includes(filtro) || p.codigo.toLowerCase().includes(filtro))
        .forEach(p => {
          let estado = "OK";
          let clase = "text-green-600";

          if (p.cantidad <= 5) {
            estado = "Bajo Stock";
            clase = "text-yellow-500";
            bajos++;
          }

          tabla.innerHTML += `
            <tr>
              <td class="p-2 border">${p.codigo}</td>
              <td class="p-2 border">${p.nombre}</td>
              <td class="p-2 border">${p.cantidad}</td>
              <td class="p-2 border font-bold ${clase}">${estado}</td>
              <td class="p-2 border">
                <button onclick="eliminarProducto('${p.codigo}')" class="bg-red-600 text-white px-4 py-2 rounded 
               shadow-md hover:shadow-lg 
               transform hover:-translate-y-1 
               transition duration-200">Eliminar</button>
              </td>
            </tr>
          `;
        });

      totalProductos.innerText = inventario.length;
      bajoStock.innerText = bajos;
    }

    // Init
    renderTabla();

    // --- SuscripciÃ³n (simulada) ---
    const susStatus = document.getElementById('susStatus');
    const btnsSus = document.querySelectorAll('.btnSuscribirse');
    const modalPago = document.getElementById('modalPago');
    const planSelectedSpan = document.getElementById('planSelected');
    const formPago = document.getElementById('formPago');
    const cancelPago = document.getElementById('cancelPago');

    function getSubscription() {
      const s = JSON.parse(localStorage.getItem('suscripcion'));
      if (!s) return null;
      // comprobar expiraciÃ³n
      if (new Date(s.expire) <= new Date()) {
        localStorage.removeItem('suscripcion');
        return null;
      }
      return s;
    }

    function updateSusUI() {
      const s = getSubscription();
      if (s) {
        susStatus.innerText = `Suscrito: ${s.plan} (vence ${new Date(s.expire).toLocaleDateString()})`;
      } else {
        susStatus.innerText = 'No suscrito';
      }
    }

    btnsSus.forEach(btn => {
      btn.addEventListener('click', () => {
        const plan = btn.dataset.plan;
        planSelectedSpan.innerText = plan;
        modalPago.classList.remove('hidden');
        modalPago.classList.add('flex');
        // prefill (opcional)
      });
    });

    cancelPago.addEventListener('click', () => {
      modalPago.classList.add('hidden');
      modalPago.classList.remove('flex');
    });

    formPago.addEventListener('submit', (e) => {
      e.preventDefault();
      // ValidaciÃ³n bÃ¡sica
      const name = document.getElementById('cardName').value.trim();
      const num = document.getElementById('cardNumber').value.replace(/\s+/g, '');
      const mm = document.getElementById('cardMonth').value.trim();
      const yy = document.getElementById('cardYear').value.trim();
      const cvc = document.getElementById('cardCVC').value.trim();

      if (!name || !num || !mm || !yy || !cvc) return alert('Completa todos los datos de la tarjeta (simulado)');

      // Simular pago: guardar suscripciÃ³n por 30 dÃ­as
      const plan = planSelectedSpan.innerText || 'Pro';
      const expire = new Date();
      expire.setDate(expire.getDate() + 30);

      localStorage.setItem('suscripcion', JSON.stringify({ plan, expire: expire.toISOString() }));
      modalPago.classList.add('hidden');
      modalPago.classList.remove('flex');
      formPago.reset();
      updateSusUI();
      alert('Pago simulado exitoso. Â¡SuscripciÃ³n activada!');
    });

    // Mostrar estado al cargar
    updateSusUI();

    // --- CÃ¡mara / EscÃ¡ner ---
    const btnEscanear = document.getElementById('btnEscanear');
    const modalCamara = document.getElementById('modalCamara');
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const captureBtn = document.getElementById('captureBtn');
    const detectBtn = document.getElementById('detectBtn');
    const stopCam = document.getElementById('stopCam');
    const closeCam = document.getElementById('closeCam');
    const scanResult = document.getElementById('scanResult');
    const manualCode = document.getElementById('manualCode');
    const applyCode = document.getElementById('applyCode');
    const btnPasteScan = document.getElementById('btnPasteScan');

    let stream = null;

    btnEscanear.addEventListener('click', async () => {
      modalCamara.classList.remove('hidden');
      modalCamara.classList.add('flex');
      scanResult.innerText = 'â€”';
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        video.srcObject = stream;
      } catch (err) {
        alert('No se pudo acceder a la cÃ¡mara: ' + err.message);
      }
    });

    closeCam.addEventListener('click', stopAndClose);
    stopCam.addEventListener('click', stopAndClose);

    function stopAndClose() {
      if (stream) {
        stream.getTracks().forEach(t => t.stop());
        stream = null;
      }
      video.srcObject = null;
      modalCamara.classList.add('hidden');
      modalCamara.classList.remove('flex');
    }

    captureBtn.addEventListener('click', () => {
      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      scanResult.innerText = 'Imagen capturada';
    });

    // Try to use BarcodeDetector API if available
    detectBtn.addEventListener('click', async () => {
      scanResult.innerText = 'Detectando...';
      // draw current frame to canvas first
      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth || 640;
      canvas.height = video.videoHeight || 480;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      // prefer BarcodeDetector if the browser supports it
      if ('BarcodeDetector' in window) {
        try {
          const barcodeDetector = new BarcodeDetector({ formats: ['qr_code','ean_13','code_128','code_39'] });
          const detections = await barcodeDetector.detect(canvas);
          if (detections.length > 0) {
            const raw = detections.map(d => d.rawValue).join(' | ');
            scanResult.innerText = raw;
            manualCode.value = raw;
            return;
          } else {
            scanResult.innerText = 'No se detectÃ³ cÃ³digo en la imagen';
          }
        } catch (err) {
          scanResult.innerText = 'Error en detector: ' + err.message;
        }
      } else {
        // Fallback: no BarcodeDetector
        scanResult.innerText = 'BarcodeDetector no soportado en este navegador. Captura la imagen y copia manualmente.';
      }
    });

    // Aplicar cÃ³digo detectado/manual al campo CÃ³digo
    applyCode.addEventListener('click', () => {
      const code = manualCode.value.trim();
      if (!code) return alert('Ingresa o detecta un cÃ³digo primero');
      document.getElementById('codigo').value = code;
      stopAndClose();
    });

    // btn para pegar desde portapapeles o facilitar inserciÃ³n
    btnPasteScan.addEventListener('click', async () => {
      // Intenta leer portapapeles (texto)
      try {
        const text = await navigator.clipboard.readText();
        if (text) {
          document.getElementById('codigo').value = text.trim();
        } else {
          alert('Portapapeles vacÃ­o. TambiÃ©n puedes usar la cÃ¡mara.');
        }
      } catch {
        alert('No pude leer el portapapeles. Otorga permisos o pega manualmente.');
      }
    });

    // Guardar inventario al cerrar la pestaÃ±a
    window.addEventListener('beforeunload', saveInventory);
  </script>
<!-- Chat de AtenciÃ³n -->
<div id="chatContainer" class="fixed bottom-20 right-5 w-80 bg-white shadow-xl rounded-lg hidden flex-col">
  <div class="bg-blue-600 text-white px-4 py-2 flex justify-between items-center rounded-t-lg">
    <span>AtenciÃ³n al Cliente</span>
    <button id="closeChat" class="text-white">âœ–</button>
  </div>
  <div id="chatMessages" class="p-4 h-64 overflow-y-auto text-sm space-y-2">
    <div class="text-gray-500">ğŸ‘‹ Hola, Â¿en quÃ© puedo ayudarte?</div>
  </div>
  <div class="p-2 border-t flex">
    <input id="chatInput" type="text" placeholder="Escribe un mensaje..." class="flex-1 border rounded px-2 py-1 text-sm" />
    <button id="sendChat" class="ml-2 bg-blue-600 text-white px-3 rounded">Enviar</button>
  </div>
</div>
<button id="openChat" class="fixed bottom-5 right-5 bg-blue-600 text-white rounded-full w-14 h-14 shadow-lg text-2xl">ğŸ’¬</button>

<script>
  // --- Chat de AtenciÃ³n ---
  const chatContainer = document.getElementById('chatContainer');
  const openChat = document.getElementById('openChat');
  const closeChat = document.getElementById('closeChat');
  const chatMessages = document.getElementById('chatMessages');
  const chatInput = document.getElementById('chatInput');
  const sendChat = document.getElementById('sendChat');

  openChat.addEventListener('click', () => {
    chatContainer.classList.remove('hidden');
    openChat.classList.add('hidden');
  });

  closeChat.addEventListener('click', () => {
    chatContainer.classList.add('hidden');
    openChat.classList.remove('hidden');
  });

  sendChat.addEventListener('click', sendMessage);
  chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendMessage();
  });

  function sendMessage() {
    const msg = chatInput.value.trim();
    if (!msg) return;
    addMessage("ğŸ§‘â€ğŸ’¼", msg, "right");
    chatInput.value = "";

    // SimulaciÃ³n de respuesta automÃ¡tica
    setTimeout(() => {
      let response = "Lo siento, aÃºn no tengo info sobre eso. ğŸ˜Š";
      if (msg.toLowerCase().includes("precio")) response = "ğŸ“¦ Puedes consultar los precios que digitaste en la lista guardada";
      if (msg.toLowerCase().includes("ayuda")) response = "ğŸ™Œ Claro, dime quÃ© necesitas y te guiarÃ©.";
      if (msg.toLowerCase().includes("suscripciÃ³n")) response = "âœ… Puedes gestionar tu suscripciÃ³n desde el botÃ³n 'Suscribirse'.";
      if (msg.toLowerCase().includes("hola")) response = "ğŸ‘‹ğŸ¼Â¡Hola! Â¿CÃ³mo puedo ayudarte hoy?";
      if (msg.toLowerCase().includes("ola")) response = "ğŸ‘‹ğŸ¼Â¡Hola! Â¿CÃ³mo puedo ayudarte hoy?";
      addMessage("ğŸ¤–", response, "left");
    }, 800);
  }

  function addMessage(sender, text, side) {
    const div = document.createElement("div");
    div.className = `flex ${side === "right" ? "justify-end" : "justify-start"}`;
    div.innerHTML = `<div class="px-3 py-2 rounded-lg ${side === "right" ? "bg-blue-100 text-right" : "bg-gray-200"}">${sender} ${text}</div>`;
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
</script>

</body>
</html>








